<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPA NEXUS | COMMAND CENTER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon-cyan: #00f2ff; --neon-purple: #7000ff; --dark-bg: #020617; }
        body { background: var(--dark-bg); color: white; font-family: 'Rajdhani', sans-serif; overflow-x: hidden; }
        .title-font { font-family: 'Orbitron', sans-serif; }
        
        /* Premium Glass Effect */
        .glass { 
            background: rgba(15, 23, 42, 0.6); 
            backdrop-filter: blur(15px); 
            border: 1px solid rgba(0, 242, 255, 0.15); 
        }

        /* Welcome Overlay */
        #overlay {
            position: fixed; inset: 0; background: rgba(2, 6, 23, 0.98);
            z-index: 1000; display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(20px); transition: opacity 0.8s ease;
        }
        
        .btn-init {
            padding: 20px 40px; border: 2px solid var(--neon-cyan);
            color: var(--neon-cyan); font-family: 'Orbitron', sans-serif;
            font-weight: bold; letter-spacing: 5px; cursor: pointer;
            transition: all 0.3s; box-shadow: 0 0 20px rgba(0, 242, 255, 0.2);
        }
        .btn-init:hover { background: var(--neon-cyan); color: black; box-shadow: 0 0 50px var(--neon-cyan); }

        /* Goal Bar Flow Animation */
        .bar-container { background: rgba(0,0,0,0.5); border-radius: 50px; border: 1px solid rgba(0, 242, 255, 0.3); }
        .bar-fill { 
            background: linear-gradient(90deg, #00f2ff, #7000ff, #00f2ff); 
            background-size: 200% 100%;
            animation: flow 2s linear infinite;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.5);
        }
        @keyframes flow { 0% { background-position: 200% 0; } 100% { background-position: 0 0; } }

        @keyframes lead-bounce {
            0%, 100% { transform: scale(1); background: transparent; }
            50% { transform: scale(1.02); background: rgba(0, 242, 255, 0.1); }
        }
        .new-lead-row { animation: lead-bounce 1.5s ease-in-out; border-left: 4px solid var(--neon-cyan); }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--neon-cyan); border-radius: 10px; }
    </style>
</head>
<body class="p-4 lg:p-10 min-h-screen flex flex-col">

    <div id="overlay">
        <div class="text-center">
            <h1 class="title-font text-5xl mb-4 italic font-black text-white">CPA <span class="text-cyan-400">NEXUS</span></h1>
            <h2 class="title-font text-sm mb-10 tracking-[0.8em] text-cyan-700">COMMAND INTERFACE</h2>
            <button onclick="initializeSystem()" class="btn-init uppercase">Initialize System</button>
            <p class="mt-8 text-gray-700 text-[10px] tracking-[0.5em] uppercase">Security Protocol Active</p>
        </div>
    </div>

    <div class="max-w-7xl mx-auto w-full flex-1 flex flex-col">
        <header class="flex flex-col md:flex-row justify-between items-center mb-10 border-b border-white/5 pb-8">
            <div class="text-center md:text-left">
                <h1 class="text-4xl font-black title-font italic text-white leading-none">CPA <span class="text-cyan-400">NEXUS</span></h1>
                <p id="system-status" class="text-cyan-800 font-bold tracking-[0.5em] text-[10px] mt-2 uppercase italic">Offline</p>
            </div>
            <div class="mt-6 md:mt-0 glass px-6 py-3 rounded-2xl">
                <span id="liveClock" class="text-lg font-bold font-mono text-cyan-400">00:00:00</span>
            </div>
        </header>

        <section class="glass p-8 rounded-[40px] mb-10 relative overflow-hidden border-l-8 border-cyan-500">
            <div class="flex flex-col md:flex-row justify-between items-end mb-6">
                <div>
                    <h2 class="text-gray-500 font-bold tracking-widest text-xs uppercase mb-1">Daily Revenue Goal</h2>
                    <div class="flex items-baseline gap-2">
                        <span class="text-5xl font-black title-font" id="dailyRev">$0.00</span>
                        <span class="text-xl text-gray-600 font-bold italic">/ $100.00</span>
                    </div>
                </div>
                <div class="text-right">
                    <span id="percentNum" class="text-4xl font-black title-font text-cyan-400">0%</span>
                </div>
            </div>
            <div class="bar-container h-4 w-full">
                <div id="goalBar" class="bar-fill h-full rounded-full" style="width: 0%"></div>
            </div>
        </section>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
            <div class="glass p-6 rounded-3xl border-b-4 border-cyan-500/30">
                <p class="text-gray-500 text-[10px] font-bold uppercase tracking-widest mb-1">Gross Net</p>
                <p id="totalNet" class="text-3xl font-black title-font">$0.00</p>
            </div>
            <div class="glass p-6 rounded-3xl border-b-4 border-purple-500/30">
                <p class="text-gray-500 text-[10px] font-bold uppercase tracking-widest mb-1">Total Conversions</p>
                <p id="totalLeads" class="text-3xl font-black title-font">0</p>
            </div>
            <div class="glass p-6 rounded-3xl border-b-4 border-pink-500/30">
                <p class="text-gray-500 text-[10px] font-bold uppercase tracking-widest mb-1">Best Territory</p>
                <p id="topCountry" class="text-3xl font-black title-font">--</p>
            </div>
            <div class="glass p-6 rounded-3xl border-b-4 border-blue-500/30">
                <p class="text-gray-500 text-[10px] font-bold uppercase tracking-widest mb-1">Avg Payout</p>
                <p id="avgPay" class="text-3xl font-black title-font">$0.00</p>
            </div>
        </div>

        <div class="glass rounded-[32px] overflow-hidden flex-1 flex flex-col shadow-2xl">
            <div class="p-5 border-b border-white/5 bg-white/5 flex justify-between items-center">
                <h3 class="text-xs font-black tracking-[0.3em] text-cyan-400 uppercase italic">Live Matrix Stream</h3>
                <span class="flex items-center gap-2">
                    <span class="w-2 h-2 bg-red-500 rounded-full animate-ping"></span>
                    <span class="text-[10px] font-bold text-gray-500 uppercase">Syncing...</span>
                </span>
            </div>
            <div class="overflow-y-auto flex-1">
                <table class="w-full text-left">
                    <thead class="text-gray-600 text-[10px] uppercase font-bold tracking-[0.2em] sticky top-0 bg-[#0f172a] z-10">
                        <tr>
                            <th class="p-6">Timestamp</th>
                            <th class="p-6">Agent_ID</th>
                            <th class="p-6">Operation</th>
                            <th class="p-6 text-right">Yield</th>
                        </tr>
                    </thead>
                    <tbody id="leadsTable" class="text-sm font-medium divide-y divide-white/5">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ðŸš¨ Your Google Web App URL ðŸš¨
        const appUrl = 'https://script.google.com/macros/s/AKfycbzkiT8xK9umDamSUgi0mjMMHMj21FXRQVS80uousnrK93ioAxOKWvxR44ClUqHT7kAvXw/exec';
        const dailyGoal = 100;
        let lastLeadCount = 0;
        let isInitialized = false;

        function initializeSystem() {
            document.getElementById('overlay').style.opacity = '0';
            setTimeout(() => document.getElementById('overlay').style.display = 'none', 800);
            isInitialized = true;
            document.getElementById('system-status').innerText = "System Matrix Active";
            document.getElementById('system-status').classList.remove('text-cyan-800');
            document.getElementById('system-status').classList.add('text-green-500');
            refreshData();
        }

        function updateClock() {
            document.getElementById('liveClock').innerText = new Date().toLocaleTimeString('en-GB');
        }
        setInterval(updateClock, 1000);

        async function refreshData() {
            if(!isInitialized) return;
            try {
                const response = await fetch(appUrl);
                const data = await response.json();
                const sorted = data.reverse();

                // Check for new lead and play sound
                if (sorted.length > lastLeadCount && lastLeadCount !== 0) {
                    const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3');
                    audio.play();
                }

                let total = 0, daily = 0, leadsCount = sorted.length;
                let countries = {}, tableHtml = '';
                const today = new Date().toDateString();

                sorted.forEach((row, index) => {
                    const pay = parseFloat(row.Payout) || 0;
                    total += pay;
                    if(new Date(row.Date).toDateString() === today) daily += pay;
                    if(row.Country) countries[row.Country] = (countries[row.Country] || 0) + 1;

                    // Animation for new row
                    const isNew = (index === 0 && sorted.length > lastLeadCount && lastLeadCount !== 0) ? 'new-lead-row' : '';

                    tableHtml += `
                        <tr class="hover:bg-cyan-500/5 transition-all group ${isNew}">
                            <td class="p-6 text-gray-600 font-mono text-xs">${new Date(row.Date).toLocaleTimeString()}</td>
                            <td class="p-6"><span class="px-3 py-1 bg-cyan-500/10 text-cyan-400 font-bold rounded-lg border border-cyan-500/20">#${row.ID}</span></td>
                            <td class="p-6 text-gray-300 font-bold uppercase tracking-tighter">${row.Offer}</td>
                            <td class="p-6 text-right font-black text-white group-hover:text-cyan-400 transition-colors">+$${pay.toFixed(2)}</td>
                        </tr>`;
                });

                // Update UI elements
                document.getElementById('dailyRev').innerText = '$' + daily.toFixed(2);
                document.getElementById('totalNet').innerText = '$' + total.toFixed(2);
                document.getElementById('totalLeads').innerText = leadsCount;
                document.getElementById('leadsTable').innerHTML = tableHtml;
                
                let avg = leadsCount > 0 ? total / leadsCount : 0;
                document.getElementById('avgPay').innerText = '$' + avg.toFixed(2);

                // Progress Calculation
                let p = (daily / dailyGoal) * 100;
                document.getElementById('goalBar').style.width = (p > 100 ? 100 : p) + '%';
                document.getElementById('percentNum').innerText = Math.round(p) + '%';

                let topC = Object.keys(countries).reduce((a, b) => countries[a] > countries[b] ? a : b, '--');
                document.getElementById('topCountry').innerText = topC;

                lastLeadCount = leadsCount;

            } catch (e) { console.log("Data Stream Interrupted..."); }
        }

        setInterval(refreshData, 1000); // 1 Second Update
        updateClock();
    </script>
</body>
</html>
